syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "common/common.proto";

package federation;

option go_package="github.com/JohnnyGlynn/strike/msgdef/federation;federation";

service Federation {
  rpc Handshake (HandshakeReq) returns (HandshakeAck);
  rpc Relay (RelayPayload) returns (RelayAck);
}

message HandshakeReq {
  string server_id = 1;
  string server_name = 2;
}

message HandshakeAck {
  bool ok = 1;
  string server_id = 2;
  string message = 3;
}

message RelayPayload {
  string envelope_id = 1;

  common.UserAddress sender = 2;
  common.UserAddress recipient = 3;

  string origin_server = 4;

  common.EncryptedEnvelope payload = 5;

  google.protobuf.Timestamp sent_at = 6;
}

message RelayAck {
  string envelope_id = 1;
  bool accepted = 2;
  string info = 3;
}

