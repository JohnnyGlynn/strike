syntax = "proto3";

import "google/protobuf/timestamp.proto";

package federation;

option go_package="./federation";

service Federation {
  rpc Ping(PingReq) returns (FedAck);
  rpc RoutePayload (FedPayload) returns (FedAck);
  rpc Ack(FedAck) returns (AckResponse);
  rpc AnnounceStatus(UserAddress) returns (FedAck);//TODO: Common proto types 
}

message PingReq {
  string origin__id = 2;
}

message UserAddress {
  string username = 1;
  string domain = 2;
  bytes id = 3;//?
}

message FedAck {
  string payload_id = 1;
  UserAddress ack_by = 2;
  string origin = 3;
  bool accepted = 4; //accepted by server
  bool delivered = 5; //delivered to client
  bool failed = 6; 
  string info = 7; //info/error
  google.protobuf.Timestamp timestamp = 8; 
  bytes pubkey = 9;
  bytes sig = 10;
}

message FedPayload {
  string payload_id = 1;
  UserAddress sender = 2;
  UserAddress recipient = 3;
  string origin = 4;
  bytes payload = 5;//Copy Client/Server payload type?
  bytes nonce = 6;
  google.protobuf.Timestamp sent_at = 7; 
  bytes pubkey = 9;
  bytes sig = 10;
}

message AckResponse {
  bool ok = 1;
  string message = 2;
}
